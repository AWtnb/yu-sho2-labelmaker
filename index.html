<!DOCTYPE html>
<!-- thanks https://qiita.com/okoppe8/items/f3b3e7688c98537512ea -->
<html lang="ja">
<meta charset="utf-8" />

<head>
    <title>宛名ラベル作成</title>
    <link rel="stylesheet" type="text/css" href="./css/index.css">
    <!-- Chrome / Firefox / Edge -->
    <link rel="icon"
        href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20100%20100%22%3E%3Ctext%20x%3D%2250%25%22%20y%3D%2250%25%22%20style%3D%22dominant-baseline%3Acentral%3Btext-anchor%3Amiddle%3Bfont-size%3A90px%3B%22%3E%F0%9F%93%AB%EF%B8%8F%3C%2Ftext%3E%3C%2Fsvg%3E">
    <!-- Safari / IE -->
    <link rel="icon alternate" type="image/png"
        href="https://cdn.jsdelivr.net/gh/jdecked/twemoji@latest/assets/72x72/1f4eb.png" />
</head>

<body>
    <a href="https://github.com/AWtnb/yu-sho2-labelmaker" target="_blank" class="github-corner"
        aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250"
            style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);"
            aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path
                d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path
                d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body"></path>
        </svg>
        <style>
            .github-corner:hover .octo-arm {
                animation: octocat-wave 560ms ease-in-out
            }

            @keyframes octocat-wave {

                0%,
                100% {
                    transform: rotate(0)
                }

                20%,
                60% {
                    transform: rotate(-25deg)
                }

                40%,
                80% {
                    transform: rotate(10deg)
                }
            }

            @media (max-width:500px) {
                .github-corner:hover .octo-arm {
                    animation: none
                }

                .github-corner .octo-arm {
                    animation: octocat-wave 560ms ease-in-out
                }
            }
        </style>
    </a>
    <div class="container">
        <h1>宛名ラベル作成</h1>
        <ul>
            <li>紙に無駄が出ないように、余りが出た場合はリストの先頭からラベルを埋め直します。</li>
            <li>セル内で改行されている場合には正常に動作しません。</li>
            <li>Google Chrome での使用を推奨します。</li>
        </ul>
        <img src="img/img_example.png">
        <p>下記ボックスに Excel から図のようにコピー＆ペーストしてください。</p>
        <div id="app">
            <textarea cols="60" rows="5" placeholder="ここにペースト！" v-model="content"></textarea>
            <button @click="load">読み込む</button>
            <table id="table1" contenteditable="true">
                <thead>
                    <tr>
                        <th>氏名</th>
                        <th>敬称</th>
                        <th>所属</th>
                        <th>郵便番号</th>
                        <th>住所</th>
                        <th>電話番号</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="(adr, idx) in addressArr" :key="idx">
                        <td :style="{color: color}">{{ adr.name }}</td>
                        <td :style="{color: color}">{{ adr.honorific }}</td>
                        <td :style="{color: color}">{{ adr.place }}</td>
                        <td :style="{color: color}">{{ adr.zipcode }}</td>
                        <td :style="{color: color}">{{ adr.address }}</td>
                        <td :style="{color: color}">{{ adr.phone }}</td>
                    </tr>
                </tbody>
            </table>
            <p>※セルを直接編集することもできます。</p>
            <button @click="print">ラベルに出力！</button>
            <p><strong>※ 内容が第三者に送信されることはありません。</strong></p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.37/dist/vue.global.js"></script>

    <script>

        const sample = [
            {
                "name": "福沢 諭吉",
                "honorific": "先生",
                "place": "慶應義塾大学",
                "zipcode": "108-8345",
                "address": "東京都港区三田2-15-45",
                "phone": "999-9999-9999",
            },
            {
                "name": "夏目 漱石",
                "honorific": "先生",
                "place": "",
                "zipcode": "113-0023",
                "address": "東京都文京区向丘2-20-7",
                "phone": "888-8888-8888",
            },
            {
                "name": "樋口 一葉",
                "honorific": "先生",
                "place": "",
                "zipcode": "113-0033",
                "address": "東京都文京区本郷4-32・31",
                "phone": "",
            },
        ];

        function toHalfWidth(str) {
            return str.replace(/[Ａ-Ｚａ-ｚ０-９]/g, function (s) {
                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
            });
        }

        function formatPostalCode(s) {
            return toHalfWidth(s).replace(/^(\d{3})([^\d])?(\d{4})$/, "$1-$3");
        }

        function parseLine(line) {
            const fields = line.split(/\t/).map(s => s.trim());
            return {
                "name": (fields[0] || ""),
                "honorific": (fields[1] || ""),
                "place": (fields[2] || ""),
                "zipcode": formatPostalCode((fields[3] || "")),
                "address": (fields[4] || ""),
                "phone": (fields[5] || ""),
            };
        }


        const vm = Vue.createApp({
            data: function () {
                return {
                    content: "",
                    color: "gray",
                    addressArr: sample,
                }
            },
            computed: {
                contentLines: function () {
                    return this.content.split(/\n/).map(line => String(line)).filter(line => line.trim());
                },
            },
            methods: {
                reset: function () {
                    this.color = "gray";
                    this.addressArr = [];
                },
                load: function () {
                    this.reset();
                    this.color = "#343434";
                    this.contentLines.forEach(line => {
                        this.addressArr.push(parseLine(line));
                    });
                },
                print: function () {
                    window.open('./print_page.html', 'newwindow', 'width=800,height=890');
                }
            }
        }).mount("#app");

    </script>
</body>

</html>