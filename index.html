<!DOCTYPE html>
<!-- thanks https://qiita.com/okoppe8/items/f3b3e7688c98537512ea -->
<html lang="ja">
<meta charset="utf-8"/>
<head>
    <title>宛名ラベル作成</title>
    <link rel="stylesheet" type="text/css" href="./css/index.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%2250%%22 y=%2250%%22 style=%22dominant-baseline:central;text-anchor:middle;font-size:90px;%22>&#x1F4EB;</text></svg>">

</head>
<body>
<div><a href="https://github.com/AWtnb/yu-sho2-labelmaker" target="_blank">Github repository</a></div>
<h1>宛名ラベル作成</h1>
<ul>
    <li>紙に無駄が出ないように、余りが出た場合はリストの先頭からラベルを埋め直します。</li>
    <li>セル内で改行されている場合には正常に動作しません。</li>
    <li>Google Chrome での使用を推奨します。</li>
</ul>

<img src="img/img_example.png">

<p>下記ボックスに Excel から図のようにコピー＆ペーストしてください。</p>


<div id="app">
    <textarea cols="60" rows="5" placeholder="ここにペースト！" v-model="content"></textarea>

    <button @click="load">読み込む</button>

    <table id="table1" contenteditable="true">
        <thead>
            <tr>
                <th>氏名</th>
                <th>敬称</th>
                <th>所属</th>
                <th>郵便番号</th>
                <th>住所</th>
                <th>電話番号</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="(adr, idx) in addressArr" :key="idx">
                <td :style="{color: color}">{{ adr.name }}</td>
                <td :style="{color: color}">{{ adr.honorific }}</td>
                <td :style="{color: color}">{{ adr.place }}</td>
                <td :style="{color: color}">{{ adr.zipcode }}</td>
                <td :style="{color: color}">{{ adr.address }}</td>
                <td :style="{color: color}">{{ adr.phone }}</td>
            </tr>
        </tbody>
    </table>

    <p>※セルを直接編集することもできます。</p>

    <button @click="print">ラベルに出力！</button>
    <p><strong>※ 内容が第三者に送信されることはありません。</strong></p>

</div>

<script src="https://cdn.jsdelivr.net/npm/vue@3.2.37/dist/vue.global.js"></script>

<script>

const sample = [
    {
        "name": "福沢 諭吉",
        "honorific": "先生",
        "place": "慶應義塾大学",
        "zipcode": "108-8345",
        "address": "東京都港区三田2-15-45",
        "phone": "999-9999-9999",
    },
    {
        "name": "夏目 漱石",
        "honorific": "先生",
        "place": "",
        "zipcode": "113-0023",
        "address": "東京都文京区向丘2-20-7",
        "phone": "888-8888-8888",
    },
    {
        "name": "樋口 一葉",
        "honorific": "先生",
        "place": "",
        "zipcode": "113-0033",
        "address": "東京都文京区本郷4-32・31",
        "phone": "",
    },
];

function toHalfWidth(str) {
    return str.replace(/[Ａ-Ｚａ-ｚ０-９]/g, function(s) {
        return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
    });
}

function formatPostalCode(s) {
    return toHalfWidth(s).replace(/^(\d{3})([^\d])?(\d{4})$/, "$1-$3");
}

function parseLine(line) {
    const fields = line.split(/\t/).map(s => s.trim());
    return {
        "name": (fields[0] || ""),
        "honorific": (fields[1] || ""),
        "place": (fields[2] || ""),
        "zipcode": formatPostalCode((fields[3] || "")),
        "address": (fields[4] || ""),
        "phone": (fields[5] || ""),
    };
}


const vm = Vue.createApp({
    data: function () {
        return {
            content: "",
            color: "gray",
            addressArr: sample,
        }
    },
    computed: {
        contentLines: function() {
            return this.content.split(/\n/).map(line => String(line)).filter(line => line.trim());
        },
    },
    methods: {
        reset: function(){
            this.color = "gray";
            this.addressArr = [];
        },
        load: function(){
            this.reset();
            this.color = "#343434";
            this.contentLines.forEach(line => {
                this.addressArr.push(parseLine(line));
            });
        },
        print: function(){
            window.open('./print_page.html', 'newwindow', 'width=800,height=890');
        }
    }
}).mount("#app");

</script>
</body>

</html>